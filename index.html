<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Certificate Verification</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:820px;margin:40px auto;padding:0 16px;line-height:1.5}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .ok{color:#0a7d32;font-weight:700}
    .bad{color:#b00020;font-weight:700}
    .muted{color:#6b7280}
    .row{margin:6px 0}
    code{background:#f3f4f6;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Certificate Verification</h1>
  <p class="muted">Scan the QR or open: <code>?id=&lt;CERTIFICATE_ID&gt;</code></p>

  <div id="status" class="row muted">Checking…</div>
  <div id="result" class="card" style="display:none"></div>

  <script>
    // Helper: read URL ?id=...
    function getParam(name){
      const p = new URLSearchParams(location.search);
      return p.get(name) || "";
    }

    const certId = getParam("id");
    const statusEl = document.getElementById("status");
    const resultEl = document.getElementById("result");

    if(!certId){
      statusEl.innerHTML = '<span class="bad">No certificate ID provided.</span> Add <code>?id=YOUR_ID</code> to the URL.';
    } else {
      statusEl.textContent = "Fetching certificate…";
      // Fetch single-file database: /certs/<ID>.json
      const url = `certs/${encodeURIComponent(certId)}.json?t=${Date.now()}`; // cache-bust
      fetch(url)
        .then(r => {
          if(!r.ok) throw new Error("Not found");
          return r.json();
        })
        .then(data => {
          statusEl.innerHTML = '<span class="ok">VALID certificate</span>';
          resultEl.style.display = "block";
          resultEl.innerHTML = `
            <div class="row"><strong>Name:</strong> ${data.name}</div>
            <div class="row"><strong>Seminar:</strong> ${data.course}</div>
            <div class="row"><strong>Issued:</strong> ${data.issueDate}</div>
            <div class="row"><strong>Certificate ID:</strong> ${data.id}</div>
            ${data.duration ? `<div class="row"><strong>Duration:</strong> ${data.duration} hours</div>` : ""}
            ${data.instructor ? `<div class="row"><strong>Instructor:</strong> ${data.instructor}</div>` : ""}
            ${data.pdfUrl ? `<div class="row"><strong>Certificate PDF:</strong> <a target="_blank" rel="noopener" href="${data.pdfUrl}">Open PDF</a></div>` : ""}
          `;
        })
        .catch(() => {
          statusEl.innerHTML = '<span class="bad">INVALID certificate</span> (ID not found)';
          resultEl.style.display = "none";
        });
    }
  </script>
</body>
</html>
